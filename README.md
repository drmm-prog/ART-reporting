# ART Data Checker

This python code is designed to check for unexpected deviations in ART reporting data, aggregated by district. 

## Pre-requisites

Although python3 is recommended, code should work with python2 or python3. Output in python2 will not be properly formatted. 

You will also need to have installed the packages `numpy`, `scipy`, and `csv`. 

## Running the code 

The checks may be run on data using the python script `run_test.py <facility_list> <art_reporting>`; the first argument being the path to the relevant facility list, and the second argument being the path to the ART reporting data. 

To run the example provided, you may type:
```
python3 run_test.py example_data/master_facility_list.csv example_data/art_reporting.csv
```

The output will list any deviations found by district in the form:
```
Suspicious data points in <district> at <dates>
```
where `<district>` is the name of the district and `<dates>` is a list of dates where deviations are found. 

There will follow a list of facilities which may have contributed to their by either a) having a notable deviation of their own at that date or b) missing data at the date. These are listed indented in the form:
```
    Missing data found at <facility> at <date>
    Deviation found at <facility> at <date>
```

The example test should produce the output:
```
Suspicious data points in Rossville at  ['2019, Q4']
	Missing data found at zajoj at 2019, Q4
	Deviation found at lunap at 2019, Q4
	Missing data found at nopaj at 2019, Q4
Suspicious data points in Krebsville at  ['2018, Q2']
	Deviation found at gujum at 2018, Q2
```

## Using the module in other code

The `run_test.py` program shows how to use the code in other modules. First you need to 
```
import Data_Checks
```

and then call the functions:
```
 facility_to_district, district_facilities = Data_Checks.get_locations(facility_file_path)
    district_data, facility_data = Data_Checks.get_art_data(art_file_path, facility_to_district)
    Data_Checks.get_deviations(district_data, district_facilities, facility_data)
```
They need to be called in this order since `get_art_data` depends on having `facility_to_district` information, and `get_deviations` requires the facility and ART data to be loaded. 

`get_locations` creates indexed data for the relationship between districts and facilities. It creates a dictionary (map) from facilities to the district in which they lie (`facility_to_district`, the first output) and a dictionary (map) from districts to the list of facilities in that district (`district_facilities`, the second output). 

`get_art_data` creates indexed data for the reported ART information by facility and by district. It creates a dictionary from districts to the number on ART in that district (`district_data`, the first output) and a dictionary from facilities to the number reported on ART at that facility (`facility_data`, the second output). 

`get_deviations` takes the indexed data generated by the earlier functions and uses it to check for deviations of 5% or more in each district, based on comparison to a cubic fit model. If there is a deviation at a particular date, it will then check all the facilities in that district for a deviation or missing entry at that date. Because facility data is more noisy, this is determined by a greater than 2-sigma deviation, based again on a cubic fit model. 